function unloadPage(){var e=pipwerks.UTILS.getSessionTime(),i=pipwerks.SCORM;if(i.connection.isActive){var t=i.API.getHandle();if(t)switch(i.version){case"1.2":pipwerks.SCORM.set("cmi.core.session_time",e);break;case"2004":pipwerks.SCORM.set("cmi.session_time",e)}}i.save(),i.quit()}var pipwerks={};pipwerks.UTILS={},pipwerks.debug={isActive:!0},pipwerks.SCORM={version:null,handleCompletionStatus:!0,handleExitMode:!0,API:{handle:null,isFound:!1},connection:{isActive:!1},data:{completionStatus:null,exitStatus:null},debug:{},sessionTime:{startTime:(new Date).getTime()}},pipwerks.SCORM.isAvailable=function(){return!0},pipwerks.SCORM.API.find=function(e){for(var i=null,t=0,s=500,n="SCORM.API.find",r=pipwerks.UTILS.trace,a=pipwerks.SCORM;!e.API&&!e.API_1484_11&&e.parent&&e.parent!=e&&s>=t;)t++,e=e.parent;if(a.version)switch(a.version){case"2004":e.API_1484_11?i=e.API_1484_11:r(n+": SCORM version 2004 was specified by user, but API_1484_11 cannot be found.");break;case"1.2":e.API?i=e.API:r(n+": SCORM version 1.2 was specified by user, but API cannot be found.")}else e.API_1484_11?(a.version="2004",i=e.API_1484_11):e.API&&(a.version="1.2",i=e.API);return i?(r(n+": API found. Version: "+a.version),r("API: "+i)):r(n+": Error finding API. \nFind attempts: "+t+". \nFind attempt limit: "+s),i},pipwerks.SCORM.API.get=function(){var e=null,i=window,t=pipwerks.SCORM.API.find,s=pipwerks.UTILS.trace;return i.parent&&i.parent!=i&&(e=t(i.parent)),!e&&i.top.opener&&(e=t(i.top.opener)),e?pipwerks.SCORM.API.isFound=!0:s("API.get failed: Can't find the API!"),e},pipwerks.SCORM.API.getHandle=function(){var e=pipwerks.SCORM.API;return e.handle||e.isFound||(e.handle=e.get()),e.handle},pipwerks.SCORM.connection.initialize=function(){var e=!1,i=pipwerks.SCORM,t=pipwerks.SCORM.data.completionStatus,s=pipwerks.UTILS.trace,n=pipwerks.UTILS.StringToBoolean,r=pipwerks.SCORM.debug,a="SCORM.connection.initialize ";if(s("connection.initialize called."),i.connection.isActive)s(a+"aborted: Connection already active.");else{var o=i.API.getHandle(),c=0;if(o){switch(i.version){case"1.2":e=n(o.LMSInitialize(""));break;case"2004":e=n(o.Initialize(""))}if(e)if(c=r.getCode(),null!==c&&0===c){if(i.connection.isActive=!0,i.handleCompletionStatus&&(t=pipwerks.SCORM.status("get")))switch(t){case"not attempted":pipwerks.SCORM.status("set","incomplete");break;case"unknown":pipwerks.SCORM.status("set","incomplete")}}else e=!1,s(a+"failed. \nError code: "+c+" \nError info: "+r.getInfo(c));else c=r.getCode(),s(null!==c&&0!==c?a+"failed. \nError code: "+c+" \nError info: "+r.getInfo(c):a+"failed: No response from server.")}else s(a+"failed: API is null.")}return e},pipwerks.SCORM.connection.terminate=function(){var e=!1,i=pipwerks.SCORM,t=pipwerks.SCORM.data.exitStatus,s=pipwerks.SCORM.data.completionStatus,n=pipwerks.UTILS.trace,r=pipwerks.UTILS.StringToBoolean,a=pipwerks.SCORM.debug,o="SCORM.connection.terminate ";if(i.connection.isActive){var c=i.API.getHandle(),p=0;if(c){if(i.handleExitMode&&!t)if("completed"!==s&&"passed"!==s)switch(i.version){case"1.2":e=i.set("cmi.core.exit","suspend");break;case"2004":e=i.set("cmi.exit","suspend")}else switch(i.version){case"1.2":e=i.set("cmi.core.exit","logout");break;case"2004":e=i.set("cmi.exit","normal")}switch(i.version){case"1.2":e=r(c.LMSFinish(""));break;case"2004":e=r(c.Terminate(""))}e?i.connection.isActive=!1:(p=a.getCode(),n(o+"failed. \nError code: "+p+" \nError info: "+a.getInfo(p)))}else n(o+"failed: API is null.")}else n(o+"aborted: Connection already terminated.");return e},pipwerks.SCORM.data.get=function(e){var i=null,t=pipwerks.SCORM,s=pipwerks.UTILS.trace,n=pipwerks.SCORM.debug,r="SCORM.data.get("+e+") ";if(t.connection.isActive){var a=t.API.getHandle(),o=0;if(a){switch(t.version){case"1.2":i=a.LMSGetValue(e);break;case"2004":i=a.GetValue(e)}if(o=n.getCode(),""!==i&&0===o)switch(e){case"cmi.core.lesson_status":case"cmi.completion_status":t.data.completionStatus=i;break;case"cmi.core.exit":case"cmi.exit":t.data.exitStatus=i}else s(r+"failed. \nError code: "+o+"\nError info: "+n.getInfo(o))}else s(r+"failed: API is null.")}else s(r+"failed: API connection is inactive.");return s(r+" value: "+i),String(i)},pipwerks.SCORM.data.set=function(e,i){var t=!1,s=pipwerks.SCORM,n=pipwerks.UTILS.trace,r=pipwerks.UTILS.StringToBoolean,a=pipwerks.SCORM.debug,o="SCORM.data.set("+e+") ";if(s.connection.isActive){var c=s.API.getHandle(),p=0;if(c){switch(s.version){case"1.2":t=r(c.LMSSetValue(e,i));break;case"2004":t=r(c.SetValue(e,i))}t?("cmi.core.lesson_status"===e||"cmi.completion_status"===e)&&(s.data.completionStatus=i):n(o+"failed. \nError code: "+p+". \nError info: "+a.getInfo(p))}else n(o+"failed: API is null.")}else n(o+"failed: API connection is inactive.");return t},pipwerks.SCORM.data.save=function(){var e=!1,i=pipwerks.SCORM,t=pipwerks.UTILS.trace,s=pipwerks.UTILS.StringToBoolean,n="SCORM.data.save failed";if(i.connection.isActive){var r=i.API.getHandle();if(r)switch(i.version){case"1.2":e=s(r.LMSCommit(""));break;case"2004":e=s(r.Commit(""))}else t(n+": API is null.")}else t(n+": API connection is inactive.");return e},pipwerks.SCORM.status=function(e,i){var t=!1,s=pipwerks.SCORM,n=pipwerks.UTILS.trace,r="SCORM.getStatus failed",a="";if(null!==e){switch(s.version){case"1.2":a="cmi.core.lesson_status";break;case"2004":a="cmi.completion_status"}switch(e){case"get":t=pipwerks.SCORM.data.get(a);break;case"set":null!==i?t=pipwerks.SCORM.data.set(a,i):(t=!1,n(r+": status was not specified."));break;default:t=!1,n(r+": no valid action was specified.")}}else n(r+": action was not specified.");return t},pipwerks.SCORM.debug.getCode=function(){var e=pipwerks.SCORM.API.getHandle(),i=pipwerks.SCORM,t=pipwerks.UTILS.trace,s=0;if(e)switch(i.version){case"1.2":s=parseInt(e.LMSGetLastError(),10);break;case"2004":s=parseInt(e.GetLastError(),10)}else t("SCORM.debug.getCode failed: API is null.");return s},pipwerks.SCORM.debug.getInfo=function(e){var i=pipwerks.SCORM.API.getHandle(),t=pipwerks.SCORM,s=pipwerks.UTILS.trace,n="";if(i)switch(t.version){case"1.2":n=i.LMSGetErrorString(e.toString());break;case"2004":n=i.GetErrorString(e.toString())}else s("SCORM.debug.getInfo failed: API is null.");return String(n)},pipwerks.SCORM.debug.getDiagnosticInfo=function(e){var i=pipwerks.SCORM.API.getHandle(),t=pipwerks.SCORM,s=pipwerks.UTILS.trace,n="";if(i)switch(t.version){case"1.2":n=i.LMSGetDiagnostic(e);break;case"2004":n=i.GetDiagnostic(e)}else s("SCORM.debug.getDiagnosticInfo failed: API is null.");return String(n)},pipwerks.SCORM.init=pipwerks.SCORM.connection.initialize,pipwerks.SCORM.get=pipwerks.SCORM.data.get,pipwerks.SCORM.set=pipwerks.SCORM.data.set,pipwerks.SCORM.save=pipwerks.SCORM.data.save,pipwerks.SCORM.quit=pipwerks.SCORM.connection.terminate,pipwerks.UTILS.StringToBoolean=function(e){switch(e.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}},pipwerks.UTILS.trace=function(e){pipwerks.debug.isActive&&window.console&&window.console.firebug&&console.log(e)},pipwerks.UTILS.getSessionTime=function(){var e=pipwerks.SCORM,i=pipwerks.SCORM.sessionTime.startTime,t=pipwerks.UTILS.convertTotalSeconds,s="00:00:00.0";if(e.connection.isActive){var n=e.API.getHandle();if(n)if(0!=i){var a=(new Date).getTime(),o=(a-i)/1e3;s=t(o)}else s="00:00:00.0"}return s},pipwerks.UTILS.convertTotalSeconds=function(e){var i=e%60;e-=i;var t=e%3600;e-=t,i=Math.round(100*i)/100;var s=new String(i),n=s,r="";if(-1!=s.indexOf(".")&&(n=s.substring(0,s.indexOf(".")),r=s.substring(s.indexOf(".")+1,s.length)),n.length<2&&(n="0"+n),s=n,r.length&&(s=s+"."+r),e%3600!=0)var a=0;else var a=e/3600;if(t%60!=0)var o=0;else var o=t/60;new String(a).length<2&&(a="0"+a),new String(o).length<2&&(o="0"+o);var c=a+":"+o+":"+s;return c};